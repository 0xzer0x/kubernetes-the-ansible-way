apiVersion: v1
kind: Config
current-context: default
clusters:
  - name: kubernetes-the-hard-way
    cluster:
      certificate-authority: "{{ (item['user'] == 'admin') | ternary('', '/var/lib/kubernetes/pki/') + 'ca.crt' }}"
      server: "https://{{ (item['filename'] == 'kube-proxy') | ternary(hostvars['loadbalancer']['ansible_host'], '127.0.0.1') }}:6443"
users:
  - name: "{{ item['user'] }}"
    user:
      client-certificate: "{{ (item['user'] == 'admin') | ternary('', '/var/lib/kubernetes/pki/') + item['filename'] }}.crt"
      client-key: "{{ (item['user'] == 'admin') | ternary('', '/var/lib/kubernetes/pki/') + item['filename'] }}.key"
contexts:
  - name: default
    context:
      cluster: kubernetes-the-hard-way
      user: "{{ item['user'] }}"
